!function(l,e){"use strict";var a,n,r=l.event;function o(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null}function h(t){return 0===Object.keys(t).length}a=r.special.debouncedresize={setup:function(){l(this).on("resize",a.handler)},teardown:function(){l(this).off("resize",a.handler)},handler:function(t,e){function s(){t.type="debouncedresize",r.dispatch.apply(o,i)}var o=this,i=arguments;n&&clearTimeout(n),e?s():n=setTimeout(s,a.threshold)},threshold:100},Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(var t,e,s=this.length;s--;)t=Math.floor(Math.random()*s),e=this[s],this[s]=this[t],this[t]=e;return this}});var i=l(e),c=e.Modernizr;l.GridRotator=function(t,e){if(this.$el=l(e),c.backgroundsize){this.$el.addClass("ri-grid-loading"),this._init(t)}},l.GridRotator.defaults={rows:4,columns:10,w1024:{rows:3,columns:8},w768:{rows:3,columns:7},w480:{rows:3,columns:5},w320:{rows:2,columns:4},w240:{rows:2,columns:3},step:"random",maxStep:3,preventClick:!0,animType:"random",animSpeed:800,animEasingOut:"linear",animEasingIn:"linear",interval:3e3,slideshow:!0,onhover:!1,nochange:[],onDraw:function(){},heightToWidthRatio:1,subImg:!1},l.GridRotator.prototype={_init:function(t){this.options=l.extend(!0,{},l.GridRotator.defaults,t),this._config()},_config:function(){var s=this;this.supportTransitions=c.csstransitions,this.supportTransforms3D=c.csstransforms3d,this.transEndEventName={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[c.prefixed("transition")]+".gridrotator",this.animTypes=this.supportTransforms3D?["fadeInOut","slideLeft","slideRight","slideTop","slideBottom","rotateLeft","rotateRight","rotateTop","rotateBottom","scale","rotate3d","rotateLeftScale","rotateRightScale","rotateTopScale","rotateBottomScale"]:["fadeInOut","slideLeft","slideRight","slideTop","slideBottom"],this.animType=this.options.animType,"random"===this.animType||this.supportTransforms3D||-1!==l.inArray(this.animType,this.animTypes)||"showHide"===this.animType||(this.animType="fadeInOut"),this.animTypesTotal=this.animTypes.length,this.$list=this.$el.children("ul"),this.$list.css("padding-left","0");var o=0,i=0,a=this.$list.find("img"),n=a.length,r=["#D92727","#FFE433","#0DB8B5"];s.options.subImg&&l("<img/>").error(function(){s.options.subImg=!1}).attr("src",s.options.subImg),a.each(function(){var e=l(this),t=e.attr("src");l("<img/>").load(function(){++o,"yes"===e.parent().attr("data-video")?(e.parent().parent().css("background-image","url("+GridRotator.assetsUrl+"/images/play_overlay.png)"),e.parent().parent().css("background-size","cover"),e.parent().css("background-image","url("+t+")"),e.parent().css("opacity","0.45")):e.parent().css("background-image","url("+t+")"),o+i===n&&(a.remove(),s.$el.removeClass("ri-grid-loading"),s.$items=s.$list.children("li"),s.$itemsCache=s.$items.clone(),s.itemsTotal=s.$items.length,s.outItems=[],s._layout(function(){s._initEvents()}),s._start())}).attr("src",t),l("<img/>").error(function(){if(++i,s.options.subImg)e.parent().css("background-image","url("+s.options.subImg+")");else{var t=Math.floor(3*Math.random());e.parent().css("background",r[t])}o+i===n&&(a.remove(),s.$el.removeClass("ri-grid-loading"),s.$items=s.$list.children("li"),s.$itemsCache=s.$items.clone(),s.itemsTotal=s.$items.length,s.outItems=[],s._layout(function(){s._initEvents()}),s._start())}).attr("src",t)})},_layout:function(t){var e=this;this._setGridDim(),this.$list.empty(),this.$items=this.$itemsCache.clone().appendTo(this.$list);var s=this.$items.filter(":gt("+(this.showTotal-1)+")"),o=s.children("a");this.outItems.length=0,o.each(function(t){e.outItems.push(l(this))}),s.remove();for(var i=document.defaultView?parseInt(document.defaultView.getComputedStyle(this.$el.get(0),null).width):this.$el.width(),a=Math.floor(i/this.columns),n=i-this.columns*Math.floor(a),r=0;r<this.rows;++r)for(var h=0;h<this.columns;++h){var c=this.columns*r+h,d=this.$items.eq(c);d.css({width:h<Math.floor(n)?a+1:a,height:Math.floor(a*this.options.heightToWidthRatio)}),-1!==l.inArray(c,this.options.nochange)&&d.addClass("ri-nochange").data("nochange",!0)}this.options.preventClick&&this.$items.children().css("cursor","default").on("click.gridrotator",!1),t&&t.call(),this.options.onDraw.call(this)},_setGridDim:function(){var t=this.$el.width();switch(!0){case t<240:this.rows=this.options.w240.rows,this.columns=this.options.w240.columns;break;case t<320:this.rows=this.options.w320.rows,this.columns=this.options.w320.columns;break;case t<480:this.rows=this.options.w480.rows,this.columns=this.options.w480.columns;break;case t<768:this.rows=this.options.w768.rows,this.columns=this.options.w768.columns;break;case t<1024:this.rows=this.options.w1024.rows,this.columns=this.options.w1024.columns;break;default:this.rows=this.options.rows,this.columns=this.options.columns}this.showTotal=this.rows*this.columns},_initEvents:function(){var e=this;i.on("debouncedresize.gridrotator",function(){e._layout()});var t=o();if(t){var s=t.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(s,function(){e._visChange()})}!c.touch&&this.options.onhover&&e.$items.on("mouseenter.gridrotator",function(){var t=l(this);t.data("active")||t.data("hovered")||t.data("nochange")||(t.data("hovered",!0),e._replace(t))}).on("mouseleave.gridrotator",function(){l(this).data("hovered",!1)})},_visChange:function(){var t;(t=o())&&document[t]?clearTimeout(this.playtimeout):this._start()},_start:function(){this.showTotal<this.itemsTotal&&this.options.slideshow&&this._showNext()},_getAnimType:function(){return"random"===this.animType?this.animTypes[Math.floor(Math.random()*this.animTypesTotal)]:this.animType},_getAnimProperties:function(t){var e,s={},o={},i={},a={},n=0;switch(this._getAnimType()){case"showHide":e=0,a.opacity=0;break;case"fadeInOut":a.opacity=0;break;case"slideLeft":s.left=t.width(),i.left=0,a.left=-t.width();break;case"slideRight":s.left=-t.width(),i.left=0,a.left=t.width();break;case"slideTop":s.top=t.height(),i.top=0,a.top=-t.height();break;case"slideBottom":s.top=-t.height(),i.top=0,a.top=t.height();break;case"rotateLeft":e=this.options.animSpeed/2,s.transform="rotateY(90deg)",i.transform="rotateY(0deg)",n=e,a.transform="rotateY(-90deg)";break;case"rotateRight":e=this.options.animSpeed/2,s.transform="rotateY(-90deg)",i.transform="rotateY(0deg)",n=e,a.transform="rotateY(90deg)";break;case"rotateTop":e=this.options.animSpeed/2,s.transform="rotateX(90deg)",i.transform="rotateX(0deg)",n=e,a.transform="rotateX(-90deg)";break;case"rotateBottom":e=this.options.animSpeed/2,s.transform="rotateX(-90deg)",i.transform="rotateX(0deg)",n=e,a.transform="rotateX(90deg)";break;case"scale":e=this.options.animSpeed/2,s.transform="scale(0)",o.transform="scale(1)",i.transform="scale(1)",n=e,a.transform="scale(0)";break;case"rotateLeftScale":o.transform="scale(1)",e=this.options.animSpeed/2,s.transform="scale(0.3) rotateY(90deg)",i.transform="scale(1) rotateY(0deg)",n=e,a.transform="scale(0.3) rotateY(-90deg)";break;case"rotateRightScale":o.transform="scale(1)",e=this.options.animSpeed/2,s.transform="scale(0.3) rotateY(-90deg)",i.transform="scale(1) rotateY(0deg)",n=e,a.transform="scale(0.3) rotateY(90deg)";break;case"rotateTopScale":o.transform="scale(1)",e=this.options.animSpeed/2,s.transform="scale(0.3) rotateX(90deg)",i.transform="scale(1) rotateX(0deg)",n=e,a.transform="scale(0.3) rotateX(-90deg)";break;case"rotateBottomScale":o.transform="scale(1)",e=this.options.animSpeed/2,s.transform="scale(0.3) rotateX(-90deg)",i.transform="scale(1) rotateX(0deg)",n=e,a.transform="scale(0.3) rotateX(90deg)";break;case"rotate3d":e=this.options.animSpeed/2,s.transform="rotate3d( 1, 1, 0, 90deg )",i.transform="rotate3d( 1, 1, 0, 0deg )",n=e,a.transform="rotate3d( 1, 1, 0, -90deg )"}return{startInProp:s,startOutProp:o,endInProp:i,endOutProp:a,delay:n,animSpeed:null!=e?e:this.options.animSpeed}},_showNext:function(t){var n=this;clearTimeout(this.playtimeout),this.playtimeout=setTimeout(function(){var t=n.options.step,e=n.options.maxStep;e>n.showTotal&&(e=n.showTotal);for(var s="random"===t?Math.floor(Math.random()*e+1):Math.min(Math.abs(t),e),o=n._getRandom(s,n.showTotal),i=0;i<s;++i){var a=n.$items.eq(o[i]);if(a.data("active")||a.data("nochange"))return n._showNext(1),!1;n._replace(a)}n._showNext()},t||Math.max(Math.abs(this.options.interval),300))},_replace:function(t){t.data("active",!0);var s=this,e=t.children("a:last"),o={width:e.width(),height:e.height()};t.data("active",!0);var i=this.outItems.shift();this.outItems.push(e.clone().css("transition","none")),i.css(o).prependTo(t);var a=this._getAnimProperties(e);i.css(a.startInProp),e.css(a.startOutProp),this._setTransition(i,"all",a.animSpeed,a.delay,this.options.animEasingIn),this._setTransition(e,"all",a.animSpeed,0,this.options.animEasingOut),this._applyTransition(i,a.endInProp,a.animSpeed,function(){var t=l(this),e=a.animSpeed===s.options.animSpeed&&h(a.endInProp)?a.animSpeed:0;setTimeout(function(){s.supportTransitions&&t.off(s.transEndEventName),t.next().remove(),t.parent().data("active",!1)},e)},0===a.animSpeed||h(a.endInProp)),this._applyTransition(e,a.endOutProp,a.animSpeed);var n=i.attr("data-video");i.attr("style");"yes"===n&&(i.parent().css("background-image","url("+GridRotator.assetsUrl+"/images/play_overlay.png)"),i.parent().css("background-size","cover"),i.css("opacity","0.45"))},_getRandom:function(t,e){for(var s=[],o=0;o<e;++o)s.push(o);return s.shuffle().slice(0,t)},_setTransition:function(t,e,s,o,i){setTimeout(function(){t.css("transition",e+" "+s+"ms "+o+"ms "+i)},25)},_applyTransition:function(t,e,s,o,i){var a=this;setTimeout(function(){l.fn.applyStyle=a.supportTransitions?l.fn.css:l.fn.animate,o&&a.supportTransitions&&(t.on(a.transEndEventName,o),i&&o.call(t)),o=o||function(){return!1},t.stop().applyStyle(e,l.extend(!0,[],{duration:s+"ms",complete:o}))},25)}};function d(t){e.console&&e.console.error(t)}l.fn.gridrotator=function(t){var e=l.data(this,"gridrotator");if("string"==typeof t){var s=Array.prototype.slice.call(arguments,1);this.each(function(){e?l.isFunction(e[t])&&"_"!==t.charAt(0)?e[t].apply(e,s):d("no such method '"+t+"' for gridrotator instance"):d("cannot call methods on gridrotator prior to initialization; attempted to call method '"+t+"'")})}else this.each(function(){e?e._init():e=l.data(this,"gridrotator",new l.GridRotator(t,this))});return e}}(jQuery,window);